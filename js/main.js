var anzhiyu_musicFirst=false;var anzhiyu_keyboard=null;var anzhiyu_musicPlaying=false;var $bodyWrap=document.getElementById("body-wrap");var anzhiyu_intype=false;var anzhiyu_keyUpEvent_timeoutId=null;var anzhiyu_keyUpShiftDelayEvent_timeoutId=null;var rm=null;var popupWindowTimer=null;var adjectives=["美丽的","英俊的","聪明的","勇敢的","可爱的","慷慨的","善良的","可靠的","开朗的","成熟的","稳重的","真诚的","幽默的","豁达的","有趣的","活泼的","优雅的","敏捷的","温柔的","温暖的","敬业的","细心的","耐心的","深沉的","朴素的","含蓄的","率直的","开放的","务实的","坚强的","自信的","谦虚的","文静的","深刻的","纯真的","朝气蓬勃的","慎重的","大方的","顽强的","迷人的","机智的","善解人意的","富有想象力的","有魅力的","独立的","好奇的","干净的","宽容的","尊重他人的","体贴的","守信的","有耐性的","有责任心的","有担当的","有远见的","有智慧的","有眼光的","有冒险精神的","有爱心的","有同情心的","喜欢思考的","喜欢学习的","具有批判性思维的","善于表达的","善于沟通的","善于合作的","善于领导的","有激情的","有幽默感的","有思想的","有个性的","有正义感的","有责任感的","有创造力的","有想象力的","有艺术细胞的","有团队精神的","有协调能力的","有决策能力的","有组织能力的","有学习能力的","有执行能力的","有分析能力的","有逻辑思维的","有创新能力的","有专业素养的","有商业头脑的"];var vegetablesAndFruits=["萝卜","白菜","芹菜","生菜","青椒","辣椒","茄子","豆角","黄瓜","西红柿","洋葱","大蒜","土豆","南瓜","豆腐","韭菜","花菜","西兰花","蘑菇","金针菇","苹果","香蕉","橙子","柠檬","猕猴桃","草莓","葡萄","桃子","杏子","李子","石榴","西瓜","哈密瓜","蜜瓜","樱桃","蓝莓","柿子","橄榄","柚子","火龙果"];var selectRandomSong=[];var musicVolume=.8;var changeMusicListFlag=false;var defaultPlayMusicList=[];var themeColorMeta,pageHeaderEl,navMusicEl,consoleEl;document.addEventListener("DOMContentLoaded",(function(){let e,t,n;let o=false;const i=n=>{const o=e=>Array.from(e).reduce(((e,t)=>e+t.offsetWidth),0);if(n){const n=o(document.querySelector("#blog_name > a").children);const i=o(document.getElementById("menus").children);e=n+i;t=document.getElementById("nav")}const i=window.innerWidth<=768||e>t.offsetWidth-120;t.classList.toggle("hide-menu",i)};const s=()=>{i(true);t.classList.add("show")};const a={open:()=>{anzhiyu.sidebarPaddingR();anzhiyu.animateIn(document.getElementById("menu-mask"),"to_show 0.5s");document.getElementById("sidebar-menus").classList.add("open");o=true},close:()=>{const e=document.body;e.style.paddingRight="";anzhiyu.animateOut(document.getElementById("menu-mask"),"to_hide 0.5s");document.getElementById("sidebar-menus").classList.remove("open");o=false}};const c=()=>{const e=()=>{const e=document.getElementById("bbTimeList");if(e){anzhiyu.scrollToDest(e.offsetTop-62,300)}else{anzhiyu.scrollToDest(document.getElementById("home_top").offsetTop-60,300)}};const t=document.getElementById("scroll-down");t&&anzhiyu.addEventListenerPjax(t,"click",e)};const l=function(){const e=GLOBAL_CONFIG.highlight;if(!e)return;const{highlightCopy:t,highlightLang:n,highlightHeightLimit:o,plugin:i}=e;const s=GLOBAL_CONFIG_SITE.isHighlightShrink;const a=t||n||s!==undefined;const c=i==="highlight.js"?document.querySelectorAll("figure.highlight"):document.querySelectorAll('pre[class*="language-"]');if(!((a||o)&&c.length))return;const l=i==="prismjs";const r=s===true?"closed":"";const d=s!==undefined?'<i class="anzhiyufont anzhiyu-icon-angle-down expand ${highlightShrinkClass}"></i>':"";const u=t?'<div class="copy-notice"></div><i class="anzhiyufont anzhiyu-icon-paste copy-button"></i>':"";const m=(e,t)=>{if(GLOBAL_CONFIG.Snackbar!==undefined){anzhiyu.snackbarShow(t)}else{const n=e.previousElementSibling;n.textContent=t;n.style.opacity=1;setTimeout((()=>{n.style.opacity=0}),800)}};const y=e=>{if(document.queryCommandSupported&&document.queryCommandSupported("copy")){document.execCommand("copy");m(e,GLOBAL_CONFIG.copy.success)}else{m(e,GLOBAL_CONFIG.copy.noSupport)}};const h=e=>{const t=e.parentNode;t.classList.add("copy-true");const n=window.getSelection();const o=document.createRange();const i=l?"pre code":"table .code pre";o.selectNodeContents(t.querySelectorAll(`${i}`)[0]);n.removeAllRanges();n.addRange(o);y(e.lastChild);n.removeAllRanges();t.classList.remove("copy-true")};const g=e=>{e.classList.toggle("closed")};const f=function(e){const t=e.target.classList;if(t.contains("expand"))g(this);else if(t.contains("copy-button"))h(this)};const p=function(){this.classList.toggle("expand-done")};const L=(e,t,n)=>{const i=document.createDocumentFragment();if(a){const t=document.createElement("div");t.className=`highlight-tools ${r}`;t.innerHTML=d+e+u;anzhiyu.addEventListenerPjax(t,"click",f);i.appendChild(t)}if(o&&t.offsetHeight>o+30){const e=document.createElement("div");e.className="code-expand-btn";e.innerHTML='<i class="anzhiyufont anzhiyu-icon-angle-double-down"></i>';anzhiyu.addEventListenerPjax(e,"click",p);i.appendChild(e)}if(n==="hl"){t.insertBefore(i,t.firstChild)}else{t.parentNode.insertBefore(i,t)}};if(l){c.forEach((e=>{if(n){const t=e.getAttribute("data-language")||"Code";const n=`<div class="code-lang">${t}</div>`;anzhiyu.wrap(e,"figure",{class:"highlight"});L(n,e)}else{anzhiyu.wrap(e,"figure",{class:"highlight"});L("",e)}}))}else{c.forEach((e=>{if(n){let t=e.getAttribute("class").split(" ")[1];if(t==="plain"||t===undefined)t="Code";const n=`<div class="code-lang">${t}</div>`;L(n,e,"hl")}else{L("",e,"hl")}}))}};function r(){document.querySelectorAll("#article-container img").forEach((function(e){const t=e.parentNode;const n=e.title||e.alt;if(n&&!t.parentNode.classList.contains("justified-gallery")){const o=document.createElement("div");o.className="img-alt is-center";o.textContent=n;t.insertBefore(o,e.nextSibling)}}))}const d=()=>{anzhiyu.loadLightbox(document.querySelectorAll("#article-container img:not(.no-lightbox)"))};const u=function(e){const t=e=>{let t="";const n=e=>e.replace(/"/g,"&quot;");e.forEach((e=>{const o=e.alt?`alt="${n(e.alt)}"`:"";const i=e.title?`title="${n(e.title)}"`:"";const s=e.address?e.address:"";const a=`\n        <div class="fj-gallery-item">\n          ${s?`<div class="tag-address">${s}</div>`:""}\n          <img src="${e.url}" ${o+i}>\n        </div>\n      `;t+=a}));return t};const n=(e,n,o)=>{const i=Number(o);const s=n.length;if(s>i)e.insertAdjacentHTML("beforeend",t(n.splice(0,i)));else{e.insertAdjacentHTML("beforeend",t(n));e.classList.remove("lazyload")}window.lazyLoadInstance&&window.lazyLoadInstance.update();return s>i?i:s};const o=async e=>{const t=await fetch(e);return await t.json()};const i=(e,o)=>{const i=e.getAttribute("data-limit")??o.length;if(!e.classList.contains("lazyload")||o.length<i){e.innerHTML=t(o);e.nextElementSibling.style.display="none"}else{if(!e.classList.contains("btn_album_detail_lazyload")||e.classList.contains("page_img_lazyload")){n(e,o,i);const t=()=>{const t=n(e,o,i);fjGallery(e,"appendImages",e.querySelectorAll(`.fj-gallery-item:nth-last-child(-n+${t})`));anzhiyu.loadLightbox(e.querySelectorAll("img"));if(t<Number(i)){s.unobserve(e.nextElementSibling)}};const s=new IntersectionObserver(((e,n)=>{e.forEach((e=>{if(e.isIntersecting){setTimeout(t(),100)}}))}));s.observe(e.nextElementSibling)}else{n(e,o,i);const t=()=>{const s=n(e,o,i);fjGallery(e,"appendImages",e.querySelectorAll(`.fj-gallery-item:nth-last-child(-n+${s})`));anzhiyu.loadLightbox(e.querySelectorAll("img"));s<i&&e.nextElementSibling.removeEventListener("click",t)};e.nextElementSibling.addEventListener("click",t)}}anzhiyu.initJustifiedGallery(e);anzhiyu.loadLightbox(e.querySelectorAll("img"));window.lazyLoadInstance&&window.lazyLoadInstance.update()};const s=()=>{e.forEach((e=>{e.classList.contains("url")?o(e.textContent).then((t=>{i(e,t)})):i(e,JSON.parse(e.textContent))}))};if(window.fjGallery){s();return}getCSS(`${GLOBAL_CONFIG.source.justifiedGallery.css}`);getScript(`${GLOBAL_CONFIG.source.justifiedGallery.js}`).then(s)};const m=function(){const e=document.getElementById("rightside");const t=window.innerHeight+56;let n=0;if(document.body.scrollHeight<=t){e.style.cssText="opacity: 1; transform: translateX(-58px)"}function o(e){const t=e>i;i=e;return t}let i=0;let s=true;const a=document.getElementById("page-header");const c=document.getElementById("popup-window");const l=typeof chatBtnHide==="function";const r=typeof chatBtnShow==="function";let d=false;const u=document.getElementById("nav-music"),m=document.getElementById("footer"),y=document.getElementById("waterfall"),h=document.getElementById("percent"),g=document.getElementById("nav-totop"),f=document.getElementById("body-wrap");let p=document.getElementById("post-comment")||document.getElementById("footer");function L(e){let t=f.clientHeight;const n=document.documentElement.clientHeight;const o=t>n?t-n:document.documentElement.scrollHeight-n;const i=e/o;const s=Math.round(i*100);const a=s>100?100:s<=0?1:s;h.textContent=a;function c(e){if(!e)return;const t=window.getComputedStyle(e).getPropertyValue("display");if(t=="none"){return}const n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;const o=e.offsetTop;const i=document.documentElement.scrollTop;const s=o-i;return s<=n}if(c(p||a>90)&&e>20){g.classList.add("long");h.textContent="返回顶部"}else{g.classList.remove("long");h.textContent=a}if(y){const t=e%document.documentElement.clientHeight;if(!d&&t+100>=document.documentElement.clientHeight){console.info(t,document.documentElement.clientHeight);setTimeout((()=>{waterfall("#waterfall")}),500)}else{setTimeout((()=>{y&&waterfall("#waterfall")}),500)}}}const E=anzhiyu.throttle((()=>{const i=window.scrollY||document.documentElement.scrollTop;const d=o(i);const u=Math.abs(n-i);if(i>60&&u<20&&u!=0){return}if(c&&c.classList.contains("show-popup-window")&&i>60&&u>20&&n!=0){anzhiyu.throttle((()=>{if(popupWindowTimer)clearTimeout(popupWindowTimer);popupWindowTimer=setTimeout((()=>{if(!c.classList.contains("popup-hide")){c.classList.add("popup-hide")}setTimeout((()=>{c.classList.remove("popup-hide");c.classList.remove("show-popup-window")}),1e3)}),1e3)}),1e3)()}n=i;if(i>26){if(d){if(a.classList.contains("nav-visible"))a.classList.remove("nav-visible");if(r&&s===true){chatBtnHide();s=false}}else{if(!a.classList.contains("nav-visible"))a.classList.add("nav-visible");if(l&&s===false){chatBtnShow();s=true}}requestAnimationFrame((()=>{anzhiyu.initThemeColor();a.classList.add("nav-fixed")}));if(window.getComputedStyle(e).getPropertyValue("opacity")==="0"){e.style.cssText="opacity: 0.8; transform: translateX(-58px)"}}else{if(i<=5){requestAnimationFrame((()=>{a.classList.remove("nav-fixed");a.classList.remove("nav-visible");anzhiyu.initThemeColor()}))}e.style.cssText="opacity: ''; transform: ''"}if(document.body.scrollHeight<=t){e.style.cssText="opacity: 0.8; transform: translateX(-58px)"}L(i)}),96);if(m){anzhiyu.intersectionObserver((()=>{if(m&&u&&768<document.body.clientWidth){u.style.bottom="-10px";u.style.opacity="0"}d=true}),(()=>{if(m&&u&&768<document.body.clientWidth){u.style.bottom="20px";u.style.opacity="1"}}))().observe(m)}E();anzhiyu.addEventListenerPjax(window,"scroll",E,{passive:true})};const y=function(){const e=GLOBAL_CONFIG_SITE.isToc;const t=GLOBAL_CONFIG.isAnchor;const n=document.getElementById("article-container");if(!(n&&(e||t)))return;let o,i,s,a;if(e){const e=document.getElementById("card-toc");i=e.querySelector(".toc-content");o=i.querySelectorAll(".toc-link");a=i.classList.contains("is-expand");const t=t=>{const n=t.target.closest(".toc-link");if(!n)return;t.preventDefault();anzhiyu.scrollToDest(anzhiyu.getEleTop(document.getElementById(decodeURI(n.getAttribute("href")).replace("#","")))-60,300);if(window.innerWidth<900){e.classList.remove("open")}};anzhiyu.addEventListenerPjax(i,"click",t);s=e=>{const t=e.getBoundingClientRect().top;const n=i.scrollTop;if(t>document.documentElement.clientHeight-100){i.scrollTop=n+150}if(t<100){i.scrollTop=n-150}}}const c=n.querySelectorAll("h1,h2,h3,h4,h5,h6");const l=Array.from(c).filter((e=>e.id!=="CrawlerTitle"));let r="";const d=function(n){if(n===0){return false}let c="";let d="";l.forEach((function(e,t){if(n>anzhiyu.getEleTop(e)-80){const n=e.id;c=n?"#"+encodeURI(n):"";d=t}}));if(r===d)return;if(t)anzhiyu.updateAnchor(c);r=d;if(e){i.querySelectorAll(".active").forEach((e=>{e.classList.remove("active")}));if(c===""){return}const e=o[d];e.classList.add("active");setTimeout((()=>{s(e)}),0);if(a)return;let t=e.parentNode;for(;!t.matches(".toc");t=t.parentNode){if(t.matches("li"))t.classList.add("active")}}};const u=anzhiyu.throttle((()=>{const e=window.scrollY||document.documentElement.scrollTop;d(e)}),100);anzhiyu.addEventListenerPjax(window,"scroll",u,{passive:true})};const h=e=>{const t=window.globalFn||{};const o=t.themeChange||{};if(!o){return}Object.keys(o).forEach((t=>{const n=o[t];n(e)}));rm&&rm.hideRightMenu();const i=n.querySelector(".menu-darkmode-text");if(e==="light"){i.textContent="深色模式"}else{i.textContent="浅色模式"}if(!GLOBAL_CONFIG_SITE.isPost){const e=document.querySelector(":root");e.style.setProperty("--anzhiyu-bar-background","var(--anzhiyu-meta-theme-color)");requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));document.documentElement.style.setProperty("--anzhiyu-main",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-theme"));document.documentElement.style.setProperty("--anzhiyu-theme-op",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"23");document.documentElement.style.setProperty("--anzhiyu-theme-op-deep",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"dd")}};const g={readmode:()=>{const e=document.body;e.classList.add("read-mode");const t=document.createElement("button");t.type="button";t.className="anzhiyufont anzhiyu-icon-xmark exit-readmode";e.appendChild(t);const n=()=>{e.classList.remove("read-mode");t.remove();t.removeEventListener("click",n)};t.addEventListener("click",n)},darkmode:()=>{const e=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";if(e==="dark"){activateDarkMode();GLOBAL_CONFIG.Snackbar!==undefined&&anzhiyu.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)}else{activateLightMode();GLOBAL_CONFIG.Snackbar!==undefined&&anzhiyu.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)}saveToLocal.set("theme",e,2);h(e)},"rightside-config":e=>{const t=e.firstElementChild;if(t.classList.contains("show")){t.classList.add("status");setTimeout((()=>{t.classList.remove("status")}),300)}t.classList.toggle("show")},"go-up":()=>{anzhiyu.scrollToDest(0,500)},"hide-aside-btn":()=>{const e=document.documentElement.classList;const t=e.contains("hide-aside")?"show":"hide";saveToLocal.set("aside-status",t,2);e.toggle("hide-aside")},"mobile-toc-button":e=>{const t=document.getElementById("card-toc");t.style.transformOrigin=`right ${e.getBoundingClientRect().top+17}px`;t.style.transition="transform 0.3s ease-in-out";t.classList.toggle("open");t.addEventListener("transitionend",(()=>{t.style.transition="";t.style.transformOrigin=""}),{once:true})},"chat-btn":()=>{window.chatBtnFn()},translateLink:()=>{window.translateFn.translatePage()}};document.getElementById("rightside").addEventListener("click",(function(e){const t=e.target.closest("[id]");if(t&&g[t.id]){g[t.id](this)}}));document.addEventListener("touchstart",(e=>{anzhiyu.removeRewardMask()}),{passive:true});const f=()=>{const e=e=>{const t=e.target.closest(".site-page.group");if(!t)return;t.classList.toggle("hide")};document.querySelector("#sidebar-menus .menus_items")&&document.querySelector("#sidebar-menus .menus_items").addEventListener("click",e)};const p=()=>{const e=()=>{a.open()};anzhiyu.addEventListenerPjax(document.getElementById("toggle-menu"),"click",e)};const L=()=>{const{limitCount:e,languages:t,copy:n,copyrightEbable:o}=GLOBAL_CONFIG.copyright;const i=i=>{if(n){anzhiyu.snackbarShow(t.copySuccess)}if(o){i.preventDefault();const n=window.getSelection(0).toString();let o=n;if(n.length>e){o=`${n}\n\n\n${t.author}\n${t.link}${window.location.href}\n${t.source}\n${t.info}`}if(i.clipboardData){return i.clipboardData.setData("text",o)}else{return window.clipboardData.setData("text",o)}}};document.body.addEventListener("copy",i)};const E=()=>{const e=document.getElementById("runtimeshow");if(e){const t=e.getAttribute("data-publishDate");e.textContent=`${anzhiyu.diffDate(t)} ${GLOBAL_CONFIG.runtime}`}};const v=()=>{const e=document.getElementById("last-push-date");if(e){const t=e.getAttribute("data-lastPushDate");e.textContent=anzhiyu.diffDate(t,true)}};const z=()=>{const e=document.querySelectorAll("#article-container table");if(!e.length)return;e.forEach((e=>{if(!e.closest(".highlight")){anzhiyu.wrap(e,"div",{class:"table-wrap"})}}))};const b=()=>{const e=document.querySelectorAll("#article-container .hide-button");if(!e.length)return;const t=function(e){const t=this;t.classList.add("open");const n=t.nextElementSibling.querySelectorAll(".gallery-container");n.length&&addJustifiedGallery(n)};e.forEach((e=>{e.addEventListener("click",t,{once:true})}))};const I=()=>{const e=document.querySelectorAll("#article-container .tabs");if(!e.length)return;const t=(e,t)=>{Array.from(e).forEach((e=>{e.classList.remove("active");if(e===t||e.id===t){e.classList.add("active")}}))};const n=(e,n)=>{const o=function(e){const o=e.target.closest("button");if(o.classList.contains("active"))return;t(this.children,o);this.classList.remove("no-default");const i=o.getAttribute("data-href");const s=this.nextElementSibling;t(s.children,i);if(n){const e=s.querySelectorAll(`#${i} .fj-gallery`);if(e.length>0){anzhiyu.initJustifiedGallery(e)}}};anzhiyu.addEventListenerPjax(e.firstElementChild,"click",o)};const o=e=>{const t=t=>{const n=t.target.closest("button");if(!n)return;anzhiyu.scrollToDest(anzhiyu.getEleTop(e),300)};anzhiyu.addEventListenerPjax(e.lastElementChild,"click",t)};e.forEach((e=>{const t=!!e.querySelectorAll(".gallery-container");n(e,t);o(e)}))};const C=()=>{const e=document.querySelector("#aside-cat-list.expandBtn");if(!e)return;const t=e=>{const t=e.target;if(t.nodeName==="I"){e.preventDefault();t.parentNode.classList.toggle("expand")}};anzhiyu.addEventListenerPjax(e,"click",t,true)};const B=()=>{const e=document.getElementById("switch-btn");if(!e)return;let t=false;const n=document.getElementById("post-comment");const o=()=>{n.classList.toggle("move");if(!t&&typeof loadOtherComment==="function"){t=true;loadOtherComment()}};anzhiyu.addEventListenerPjax(e,"click",o)};const O=function(){const e=GLOBAL_CONFIG.noticeOutdate;const t=anzhiyu.diffDate(GLOBAL_CONFIG_SITE.postUpdate);if(t>=e.limitDay){const n=document.createElement("div");n.className="post-outdate-notice";n.textContent=e.messagePrev+" "+t+" "+e.messageNext;const o=document.getElementById("article-container");if(e.position==="top"){o.insertBefore(n,o.firstChild)}else{o.appendChild(n)}}};const G=()=>{window.lazyLoadInstance=new LazyLoad({elements_selector:"img",threshold:0,data_src:"lazy-src"})};const w=function(e){e.forEach((e=>{const t=e.getAttribute("datetime");e.textContent=anzhiyu.diffDate(t,true);e.style.display="inline"}))};const A=function(){const e=document.querySelector(".topGroup");if(!e)return;e.addEventListener("mouseleave",(function(){document.getElementById("todayCard").classList.remove("hide");document.getElementById("todayCard").style.zIndex=1}))};const k=function(){let e=1,t="",n=3;let o=document.createElement("div");o.id="owo-big";let i=document.querySelector("body");i.appendChild(o);const s=new MutationObserver((e=>{e.forEach((e=>{const t=e.addedNodes;for(let e=0;e<t.length;e++){const n=t[e];if(n.nodeType===Node.ELEMENT_NODE&&n.classList.contains("OwO-body")&&!n.classList.contains("comment-barrage")){const e=n;e.addEventListener("contextmenu",(e=>e.preventDefault()));e.addEventListener("mouseover",c);e.addEventListener("mouseout",l)}}}))}));const a={childList:true,subtree:true};s.observe(document.getElementById("post-comment"),a);function c(s){if(s.target.tagName=="IMG"&&e){e=0;t=setTimeout((()=>{let e=s.target.clientHeight*n;let t=s.target.clientWidth*n;let a=s.x-s.offsetX-(t-s.target.clientWidth)/2;if(a+t>i.clientWidth){a-=a+t-i.clientWidth+10}if(a<0)a=10;let c=s.y-s.offsetY;o.style.height=e+"px";o.style.width=t+"px";o.style.left=a+"px";o.style.top=c+"px";o.style.display="flex";o.innerHTML=`<img src="${s.target.src}">`}),100)}}function l(n){o.style.display="none";e=1;clearTimeout(t)}};const _=async()=>{const e=document.querySelector(":root");const t=document.getElementById("post-top-bg")?.src;if(!t){e.style.setProperty("--anzhiyu-bar-background","var(--anzhiyu-meta-theme-color)");requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));document.documentElement.style.setProperty("--anzhiyu-main",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-theme"));document.documentElement.style.setProperty("--anzhiyu-theme-op",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"23");document.documentElement.style.setProperty("--anzhiyu-theme-op-deep",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"dd");return}if(GLOBAL_CONFIG.mainTone){if(GLOBAL_CONFIG_SITE.postMainColor){let t=GLOBAL_CONFIG_SITE.postMainColor;if(F(t)==="light"){t=S(T(t),-40)}e.style.setProperty("--anzhiyu-bar-background",t);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));if(GLOBAL_CONFIG.mainTone.cover_change){document.documentElement.style.setProperty("--anzhiyu-main",t);document.documentElement.style.setProperty("--anzhiyu-theme-op",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"23");document.documentElement.style.setProperty("--anzhiyu-theme-op-deep",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"dd")}}else{const n="var(--anzhiyu-theme)";let o="";if(GLOBAL_CONFIG.mainTone.mode=="cdn"||GLOBAL_CONFIG.mainTone.mode=="both"){o=t+"?imageAve"}else if(GLOBAL_CONFIG.mainTone.mode=="api"){o=GLOBAL_CONFIG.mainTone.api+t}try{const i=await fetch(o);if(i.ok&&i.headers.get("content-type")?.includes("application/json")){const t=await i.json();let n=GLOBAL_CONFIG.mainTone.mode=="cdn"||GLOBAL_CONFIG.mainTone.mode=="both"?"#"+t.RGB.slice(2):t.RGB;if(F(n)==="light"){n=S(T(n),-40)}e.style.setProperty("--anzhiyu-bar-background",n);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));if(GLOBAL_CONFIG.mainTone.cover_change){document.documentElement.style.setProperty("--anzhiyu-main",n);document.documentElement.style.setProperty("--anzhiyu-theme-op",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"23");document.documentElement.style.setProperty("--anzhiyu-theme-op-deep",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"dd")}}else{if(GLOBAL_CONFIG.mainTone.mode=="both"){try{const o=await fetch(GLOBAL_CONFIG.mainTone.api+t);if(o.ok&&o.headers.get("content-type")?.includes("application/json")){const t=await o.json();let n=t.RGB;if(F(n)==="light"){n=S(T(n),-40)}e.style.setProperty("--anzhiyu-bar-background",n);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));if(GLOBAL_CONFIG.mainTone.cover_change){document.documentElement.style.setProperty("--anzhiyu-main",n);document.documentElement.style.setProperty("--anzhiyu-theme-op",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"23");document.documentElement.style.setProperty("--anzhiyu-theme-op-deep",getComputedStyle(document.documentElement).getPropertyValue("--anzhiyu-main")+"dd")}}else{e.style.setProperty("--anzhiyu-bar-background",n);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));document.documentElement.style.setProperty("--anzhiyu-main",n)}}catch{e.style.setProperty("--anzhiyu-bar-background",n);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));document.documentElement.style.setProperty("--anzhiyu-main",n)}}else{e.style.setProperty("--anzhiyu-bar-background",n);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));document.documentElement.style.setProperty("--anzhiyu-main",n)}}}catch(t){console.error("Error fetching data:",t);e.style.setProperty("--anzhiyu-bar-background",n);requestAnimationFrame((()=>{anzhiyu.initThemeColor()}));document.documentElement.style.setProperty("--anzhiyu-main",n)}}}};const T=e=>{const t=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;if(/^(rgb|RGB)/.test(e)){const t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(",");return t.reduce(((e,t)=>{const n=Number(t).toString(16).padStart(2,"0");return e+n}),"#")}if(t.test(e)){if(e.length===4){return Array.from(e.slice(1)).reduce(((e,t)=>e+t+t),"#")}return e}return e};const S=(e,t)=>{const n=e.startsWith("#");if(n){e=e.slice(1)}let o=parseInt(e,16);const i=(e,t)=>{e+=t;return e>255?255:e<0?0:e};const s=i(o>>16,t);const a=i(o>>8&255,t);const c=i(o&255,t);return(n?"#":"")+String("000000"+(c|a<<8|s<<16).toString(16)).slice(-6)};const F=e=>{const t=e=>{const t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,((e,t,n,o)=>t+t+n+n+o+o));const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?`rgb(${parseInt(n[1],16)}, ${parseInt(n[2],16)}, ${parseInt(n[3],16)})`:null};const n=t(e);const o=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);const[i,s,a,c]=o;const l=(s*299+a*587+c*114)/255e3;return l>=.5?"light":"dark"};const x=function(){var e=document.getElementById("toPageText");if(e){e.addEventListener("keydown",(e=>{if(e.keyCode===13){anzhiyu.toPage();var t=document.getElementById("toPageButton");var n=t.href;pjax.loadUrl(n)}}))}};const N=function(){const e=setInterval((()=>{if(navMusicEl&&navMusicEl.querySelector("#nav-music meting-js").aplayer){clearInterval(e);let t='<i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span>';let n='<i class="anzhiyufont anzhiyu-icon-pause"></i><span>暂停音乐</span>';navMusicEl.querySelector("#nav-music meting-js").aplayer.on("pause",(function(){navMusicEl.classList.remove("playing");document.getElementById("menu-music-toggle").innerHTML=t;document.getElementById("nav-music-hoverTips").innerHTML="音乐已暂停";document.querySelector("#consoleMusic").classList.remove("on");anzhiyu_musicPlaying=false;navMusicEl.classList.remove("stretch")}));navMusicEl.querySelector("#nav-music meting-js").aplayer.on("play",(function(){navMusicEl.classList.add("playing");document.getElementById("menu-music-toggle").innerHTML=n;document.querySelector("#consoleMusic").classList.add("on");anzhiyu_musicPlaying=true}))}}),16)};window.onkeydown=function(e){123===e.keyCode&&anzhiyu.snackbarShow("开发者模式已打开，请遵循GPL协议",!1)};function P(){const e=GLOBAL_CONFIG.greetingBox.list;const t=GLOBAL_CONFIG.greetingBox.default;let n=document.createElement("div");n.id="greeting";setTimeout((()=>{n.classList.add("shown")}),1e3);let o=document.getElementById("greetingBox");if(!o)return;o.appendChild(n);const i=(new Date).getHours();let s=t;for(let t=0;t<e.length;t++){if(i>=e[t].startTime&&i<=e[t].endTime){s=e[t].greeting;break}}n.innerHTML=s;setTimeout((()=>{n.classList.remove("shown");setTimeout((()=>{o.remove()}),500)}),3e3)}function q(){const e=(e,t="UTF-8",n,o)=>new Promise(((i,s)=>{const a=document.createElement("script");a.src=e;a.async=true;if(o){a.setAttribute("id",o)}if(t){a.setAttribute("charset",t)}if(n){a.setAttribute("crossorigin",n)}a.onerror=s;a.onload=a.onreadystatechange=function(){const e=this.readyState;if(e&&e!=="loaded"&&e!=="complete")return;a.onload=a.onreadystatechange=null;i()};document.head.appendChild(a)}));const t=[{url:"https://sdk.51.la/js-sdk-pro.min.js",charset:"UTF-8",crossorigin:false,id:"LA_COLLECT"},{url:"https://sdk.51.la/perf/js-sdk-perf.min.js",crossorigin:"anonymous"}];Promise.all(t.map((({url:t,charset:n,crossorigin:o,id:i})=>e(t,n,o,i)))).then((()=>{LA.init({id:GLOBAL_CONFIG.LA51.ck,ck:GLOBAL_CONFIG.LA51.ck});(new LingQue.Monitor).init({id:GLOBAL_CONFIG.LA51.LingQueMonitorID,sendSuspicious:true})})).catch((e=>{console.error("加载51a统计异常，本地加载403是正常情况:",e)}))}function j(){const e=document.querySelectorAll("input, textarea");const t=Array.from(e).filter((e=>{if(e.id!=="center-console"||e.id!=="page-type"){return}}));t.forEach((e=>{e.addEventListener("focus",(()=>{anzhiyu_intype=true}));e.addEventListener("blur",(()=>{anzhiyu_intype=false}))}))}function M(){anzhiyu_keyboard=localStorage.getItem("keyboardToggle")?localStorage.getItem("keyboardToggle"):false;function e(){const e=window;e.removeEventListener("keydown",t);e.removeEventListener("keyup",n);e.addEventListener("keydown",t);e.addEventListener("keyup",n)}function t(e){const t=e.keyCode===27;const n=e.shiftKey;const o=anzhiyu_keyboard;const i=anzhiyu_intype;if(t){anzhiyu.hideLoading();anzhiyu.hideConsole();rm&&rm.hideRightMenu()}const s=GLOBAL_CONFIG.shortcutKey.delay?GLOBAL_CONFIG.shortcutKey.delay:100;const a=GLOBAL_CONFIG.shortcutKey.shiftDelay?GLOBAL_CONFIG.shortcutKey.shiftDelay:200;if(o&&n&&!i){anzhiyu_keyUpShiftDelayEvent_timeoutId=setTimeout((()=>{switch(e.keyCode){case 16:anzhiyu_keyUpEvent_timeoutId=setTimeout((()=>{document.querySelector("#keyboard-tips").classList.add("show")}),a);break;case 65:anzhiyu.switchConsole();break;case 77:anzhiyu.musicToggle();break;case 75:anzhiyu.keyboardToggle();break;case 73:anzhiyu.rightMenuToggle();break;case 82:toRandomPost();break;case 72:pjax.loadUrl("/");break;case 68:g.darkmode();break;case 70:pjax.loadUrl("/fcircle/");break;case 76:pjax.loadUrl("/link/");break;case 80:pjax.loadUrl("/about/");break;default:break}e.preventDefault()}),s)}}window.onfocus=function(){document.getElementById("keyboard-tips").classList.remove("show")};function n(e){anzhiyu_keyUpEvent_timeoutId&&clearTimeout(anzhiyu_keyUpEvent_timeoutId);anzhiyu_keyUpShiftDelayEvent_timeoutId&&clearTimeout(anzhiyu_keyUpShiftDelayEvent_timeoutId);if(e.keyCode===16){const e=document.querySelector("#keyboard-tips");e.classList.remove("show")}}e()}function D(){let e=GLOBAL_CONFIG.diytitle.leaveTitle;let t=GLOBAL_CONFIG.diytitle.backTitle;let n=document.title;let o;document.addEventListener("visibilitychange",(function(){if(document.hidden){document.title=e;clearTimeout(o)}else{document.title=t+n;o=setTimeout((function(){document.title=n}),2e3)}}))}function H(e,t){const n=document.getElementById(e);if(n&&t){const e=n.querySelector(t);e&&e.addEventListener("click",g.darkmode)}else if(n){n.addEventListener("click",g.darkmode)}}const $=function(){window.addEventListener("resize",(()=>{i(false);o&&anzhiyu.isHidden(document.getElementById("toggle-menu"))&&a.close()}));document.getElementById("menu-mask").addEventListener("click",(e=>{a.close()}));n=document.getElementById("rightMenu");H("menu-darkmode");H("sidebar",".darkmode_switchbutton");f();GLOBAL_CONFIG.islazyload&&G();GLOBAL_CONFIG.copyright!==undefined&&L();GLOBAL_CONFIG.navMusic&&N();if(GLOBAL_CONFIG.shortcutKey&&document.getElementById("consoleKeyboard")){localStorage.setItem("keyboardToggle","true");document.getElementById("consoleKeyboard").classList.add("on");anzhiyu_keyboard=true;M()}if(GLOBAL_CONFIG.autoDarkmode){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{if(saveToLocal.get("theme")!==undefined)return;e.matches?h("dark"):h("light")}))}GLOBAL_CONFIG.greetingBox&&P();GLOBAL_CONFIG.LA51&&q()};window.refreshFn=function(){s();themeColorMeta=document.querySelector('meta[name="theme-color"]');pageHeaderEl=document.getElementById("page-header");navMusicEl=document.getElementById("nav-music");consoleEl=document.getElementById("console");H("console",".darkmode_switchbutton");if(GLOBAL_CONFIG_SITE.isPost){GLOBAL_CONFIG.noticeOutdate!==undefined&&O();GLOBAL_CONFIG.relativeDate.post&&w(document.querySelectorAll("#post-meta time"))}else{if(GLOBAL_CONFIG.relativeDate.homepage){w(document.querySelectorAll("#recent-posts time"))}else if(GLOBAL_CONFIG.relativeDate.simplehomepage){w(document.querySelectorAll("#recent-posts time"),true)}GLOBAL_CONFIG.runtime&&E();v();C()}GLOBAL_CONFIG.diytitle&&D();y();GLOBAL_CONFIG_SITE.isHome&&c();l();GLOBAL_CONFIG.isPhotoFigcaption&&r();m();window.scrollCollect&&window.scrollCollect();const e=document.querySelectorAll("#content-inner .fj-gallery");e.length&&u(e);d();z();b();I();B();document.getElementById("toggle-menu").addEventListener("click",(()=>{a.open()}));if(document.getElementById("post-comment"))k();A();_();x();p();document.getElementById("page-name").innerText=document.title.split(` | ${GLOBAL_CONFIG_SITE.configTitle}`)[0];anzhiyu.initIndexEssay();anzhiyu.changeTimeInEssay();anzhiyu.removeBodyPaceClass();anzhiyu.qrcodeCreate();anzhiyu.changeTimeInAlbumDetail();anzhiyu.reflashEssayWaterFall();anzhiyu.sayhi();anzhiyu.stopImgRightDrag();anzhiyu.addNavBackgroundInit();anzhiyu.setValueToBodyType();anzhiyu.catalogActive();anzhiyu.tagsPageActive();anzhiyu.categoriesBarActive();anzhiyu.topCategoriesBarScroll();anzhiyu.switchRightClickMenuHotReview();anzhiyu.getCustomPlayList();anzhiyu.addEventListenerConsoleMusicList(false);anzhiyu.initPaginationObserver();setTimeout((()=>{j();if(typeof addFriendLinksInFooter==="function"){addFriendLinksInFooter()}}),200)};refreshFn();$()}));